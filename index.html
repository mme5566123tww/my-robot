<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è²¼å¿ƒæ©Ÿå™¨äºº</title>
    
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="icon" type="image/png" href="./icon.png">
    <meta name="theme-color" content="#353535">

    <style>
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #7494ad; font-family: sans-serif; overflow: hidden; }
        #chat-window { display: flex; flex-direction: column; height: 100vh; width: 100%; max-width: 500px; margin: 0 auto; position: relative; }
        .header { background-color: #353535; color: white; padding: 15px; text-align: center; font-weight: bold; }
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 10px 14px; border-radius: 18px; font-size: 16px; animation: fadeIn 0.3s ease; background-color: white; color: black; align-self: flex-start; border-bottom-left-radius: 4px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .footer { padding: 20px; display: flex; justify-content: center; }
        button { background-color: #4e92df; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; }
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>

<div id="chat-window">
    <div class="header">è²¼å¿ƒæ©Ÿå™¨äºº</div>
    <div id="messages"></div>
    <div class="footer" id="action-bar"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
    // é€™è£¡å°±æ˜¯ä½ åŸæœ¬æ¼æ‰çš„ <script> æ¨™ç±¤ï¼
    const msgContainer = document.getElementById('messages');
    const actionBar = document.getElementById('action-bar');

    // è¼‰å…¥éŸ³æ•ˆ
    const btnSound = new Audio('./button sound effect.mp3');
    const fireworkSound = new Audio('./celebrate.mp3');

    function sendMsg(text) {
        const div = document.createElement('div');
        div.className = 'msg';
        div.innerText = text;
        msgContainer.appendChild(div);
        msgContainer.scrollTop = msgContainer.scrollHeight;
    }

    function startSequence() {
        msgContainer.innerHTML = '';
        actionBar.innerHTML = '';
        setTimeout(() => {
            sendMsg("ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„è²¼å¿ƒæ©Ÿå™¨äººã€‚");
            setTimeout(() => {
                sendMsg("é€™é‚Šä¸»äººæœ‰æº–å‚™ä¸€å€‹å°ç¦®ç‰©ï¼Œè«‹æ‚¨æ‰“é–‹æ¥æ”¶ ğŸ");
                const btn = document.createElement('button');
                btn.innerText = "æ‰“é–‹æ¥æ”¶";
                btn.onclick = () => { btnSound.play(); receiveGift(); };
                actionBar.appendChild(btn);
            }, 1000);
        }, 800);
    }

    function receiveGift() {
        actionBar.innerHTML = '';
        setTimeout(() => {
            sendMsg("ä½ å°±æ˜¯ä¸»äººèªªçš„é‚£å€‹å¤©å¤©æ™šä¸Š EMO é»‘ç™½äº‚å“­çš„å¥³ç”Ÿå°ä¸å°ï¼Ÿ");
            setTimeout(() => {
                sendMsg("ç¾åœ¨çµ¦æˆ‘ç¬‘ï¼ä¸è¦ EMO ä¸è¦å“­ï¼æ‡‚å—ï¼Ÿå¥³äººï¼ğŸ˜");
                fireworkSound.play();
                triggerFireworks();
            }, 1500);
        }, 800);
    }

    function triggerFireworks() {
        const end = Date.now() + 5000;
        (function frame() {
            confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0, y: 0.6 } });
            confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1, y: 0.6 } });
            if (Date.now() < end) requestAnimationFrame(frame);
            else finishConversation();
        }());
    }

    function finishConversation() {
        setTimeout(() => {
            sendMsg("ç…™ç«çœ‹å®Œäº†ï¼Œä½ å¯ä»¥ç¡è¦ºäº†ã€‚ğŸ’¤");
            setTimeout(() => {
                const resetBtn = document.createElement('button');
                resetBtn.innerText = "å†çœ‹ä¸€æ¬¡";
                resetBtn.onclick = () => { btnSound.play(); startSequence(); };
                actionBar.appendChild(resetBtn);
            }, 1000);
        }, 500);
    }

    window.onload = startSequence;
</script>
</body>
</html>
